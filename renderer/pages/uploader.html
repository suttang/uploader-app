<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../components/drop-area.html">


<dom-module id="box-page-uploader">

  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
        background: #f3f3f3;
      }
      strong {
          font-weight: 500;
      }
    </style>

        <button on-click="compress">compress</button>
        <ul>
            <template is="dom-repeat" items="{{files}}">
                <li>{{item.name}}</li>
            </template>
        </ul>
        <p>
          Drop <strong>folder</strong> or <strong>files</strong> here
        </p>
        <!-- <box-drop-area id="uploadArea"></box-drop-area> -->

  </template>

  <script>

    const electron = require('electron');
    const fs = electron.remote.require('fs');
    const archiver = electron.remote.require('archiver');
    const archive = archiver('zip');
    const output = fs.createWriteStream('/Users/suttang/Desktop/archive_from_archiver.zip');
    // output.on('close', function() {
    //     console.log('archiver has been finalized and the output file descriptor has closed.');
    // });
    archive.pipe(output);


    Polymer({
      is: 'box-page-uploader',
      listeners: {
        dragenter: 'handleDragEnter',
        dragover: 'handleDragOver',
        dragleave: 'handleDragLeave',
        drop: 'handleDrop',
      },
      properties: {
        files: {
          type: Array,
          value: function() {
            return [];
          }
        }
      },
      handleDragEnter(event) {
          event.preventDefault();
          console.log("DRAG OVER");
      },
      handleDragOver(event) {
          event.preventDefault();
          console.log("DRAG OVER");
      },
      handleDragLeave(event) {
          event.preventDefault();
          console.log("DRAG LELAVE");
      },
      handleDrop(event) {
        event.preventDefault();
        let index = 0;
        for (let item of event.dataTransfer.items) {
          let entry = item.webkitGetAsEntry();
          let file = event.dataTransfer.files[index];
          if (entry.isFile) {
            archive.append(fs.createReadStream(file.path), { name: file.name });
          } else if (entry.isDirectory) {
            archive.directory(file.path, file.name, file);
          }
          index++;
        }
      },
      ready() {},
      compress() {
        archive.finalize();
      }
    });

  </script>

</dom-module>
